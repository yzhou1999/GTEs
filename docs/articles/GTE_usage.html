<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GTEs">
<title>Group technical effects calculation and highly batch-sensitive genes (HBGs) selection â€¢ GTEs</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Group technical effects calculation and highly batch-sensitive genes (HBGs) selection">
<meta property="og:description" content="GTEs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GTEs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/GTE_usage.html">Group technical effects calculation and highly batch-sensitive genes (HBGs) selection</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/yzhou1999/GTEs/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Group technical effects calculation and highly batch-sensitive genes (HBGs) selection</h1>
                        <h4 data-toc-skip class="author">Yang Zhou</h4>
            
            <h4 data-toc-skip class="date">2024-06-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/yzhou1999/GTEs/blob/HEAD/vignettes/GTE_usage.Rmd" class="external-link"><code>vignettes/GTE_usage.Rmd</code></a></small>
      <div class="d-none name"><code>GTE_usage.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">0. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>GTE (Group Technique Effects) quantifies batch effects for individual
genes in single-cell data. Then, we can select those genes that dominate
the batch effects in the dataset, called highly batch-sensitive genes
(HBGs), with remaining genes called non-highly batch-sensitive genes
(non-HBGs). In this vignette, we demonstrate on a single-cell RNA
sequencing (scRNA-seq) dataset (<a href="https://www.nature.com/articles/s41586-021-03500-8" class="external-link">mouse
cortex</a>) and a single-cell proteomics dataset (<a href="https://www.nature.com/articles/s41587-021-00927-2" class="external-link">human PBMCs
(CITE-seq)</a>) how to estimate and remove batch effects in a dataset
using GTE.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yzhou1999/GTEs" class="external-link">GTEs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">irlba</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jlmelville/uwot" class="external-link">uwot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">randomcoloR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="application-of-gte-on-scrna-seq-data">1. Application of GTE on scRNA-seq data<a class="anchor" aria-label="anchor" href="#application-of-gte-on-scrna-seq-data"></a>
</h2>
<div class="section level3">
<h3 id="load-data-matrix-and-metadata">1.1 Load data matrix and metadata<a class="anchor" aria-label="anchor" href="#load-data-matrix-and-metadata"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/home/server/zy/group_scripts/datasets_preparation/mouse_cortex/X.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Formal class 'dgCMatrix' [package "Matrix"] with 6 slots</span></span>
<span><span class="co">##   ..@ i       : int [1:1803043092] 1 2 3 5 7 8 10 14 16 17 ...</span></span>
<span><span class="co">##   ..@ p       : int [1:406188] 0 7848 15587 22687 30777 40679 49245 57444 65947 70841 ...</span></span>
<span><span class="co">##   ..@ Dim     : int [1:2] 19942 406187</span></span>
<span><span class="co">##   ..@ Dimnames:List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:19942] "Defb25" "Ankrd9" "Fdx2" "Timm23" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:406187] "scRNA SMART.SM-D9D8O_S03_E1-50" "scRNA SMART.SM-DAIH5_S47_E1-50" "scRNA SMART.SM-DD44L_S43_E1-50" "scRNA SMART.SM-D9E5O_S40_E1-50" ...</span></span>
<span><span class="co">##   ..@ x       : num [1:1803043092] 0.509 0.276 0.372 0.649 1.569 ...</span></span>
<span><span class="co">##   ..@ factors : list()</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/home/server/zy/group_scripts/datasets_preparation/mouse_cortex/Meta.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    406187 obs. of  4 variables:</span></span>
<span><span class="co">##  $ Batch     : chr  "scRNA SMART" "scRNA SMART" "scRNA SMART" "scRNA SMART" ...</span></span>
<span><span class="co">##  $ SubClass  : chr  "L6 CT" "L6 CT" "Lamp5" "L6 CT" ...</span></span>
<span><span class="co">##  $ Protocol  : chr  "Smart-seq v4" "Smart-seq v4" "Smart-seq v4" "Smart-seq v4" ...</span></span>
<span><span class="co">##  $ Technology: chr  "scRNA" "scRNA" "scRNA" "scRNA" ...</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The highly variable genes (HVGs) are already calculated.</span></span>
<span><span class="va">hvgs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"/home/server/zy/group_scripts/datasets_preparation/mouse_cortex/vargs.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">hvgs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4000</span></span></code></pre>
<p>The data has multiple group variables available, which we will use
separately for the GTE calculation. We also add a <code>source</code>
group variable, to indicate that the data is biologically
homogeneous.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span><span class="op">$</span><span class="va">Source</span> <span class="op">=</span> <span class="st">"healthy MOp"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualization-of-raw-data">1.2 Visualization of raw data<a class="anchor" aria-label="anchor" href="#visualization-of-raw-data"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/randomcoloR/man/distinctColorPalette.html" class="external-link">distinctColorPalette</a></span><span class="op">(</span><span class="fl">24</span><span class="op">)</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">hvgs</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">raw_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">raw_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">raw_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">raw_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">raw_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">raw_umap</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">raw_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">raw_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"SubClass"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p3</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">raw_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Protocol"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p4</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">raw_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Technology"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p5</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">raw_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Source"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, <span class="va">p4</span>, <span class="va">p5</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-4-1.png" width="2112"></p>
<p>We can observe strong batch effects in the dataset.</p>
</div>
<div class="section level3">
<h3 id="gte-calculation-and-hbgs-selection">1.3 GTE calculation and HBGs selection<a class="anchor" aria-label="anchor" href="#gte-calculation-and-hbgs-selection"></a>
</h3>
<div class="section level4">
<h4 id="cell-type-group-variable">1.3.1 Cell type group variable<a class="anchor" aria-label="anchor" href="#cell-type-group-variable"></a>
</h4>
<p>We calculate the GTE using cell type group variable. For the data
matrix with many features, we can divide multiple feature subsets for
calculation, which is consistent with the result of direct calculation,
but more memory saving.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">GTE_ct0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">gene_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/Run.GroupTechEffects.html">Run.GroupTechEffects</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">x</span>, <span class="op">]</span>, <span class="va">meta</span>, g_factor <span class="op">=</span> <span class="st">"SubClass"</span>, b_factor <span class="op">=</span> <span class="st">"Batch"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GTE_ct</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">GTE_ct</span><span class="op">$</span><span class="va">GroupTechEffects</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">GTE_ct0</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">GroupTechEffects</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">GTE_ct</span><span class="op">$</span><span class="va">OverallTechEffects</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">'c'</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">GTE_ct0</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">OverallTechEffects</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">GTE_ct</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ GroupTechEffects  : num [1:19942, 1:24] 7.07e-12 6.79e-06 4.46e-07 4.46e-05 0.00 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:19942] "Defb25" "Ankrd9" "Fdx2" "Timm23" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:24] "Astro" "CR" "Endo" "L2/3 IT" ...</span></span>
<span><span class="co">##  $ OverallTechEffects: Named num [1:19942] 7.59e-09 6.24e-04 3.27e-04 4.71e-03 2.06e-09 ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:19942] "Defb25" "Ankrd9" "Fdx2" "Timm23" ...</span></span></code></pre>
<p>The results contain GTE vectors for each cell type and GTE vector for
the entire dataset. The latter is the sum of the former. We only use the
latter for further analysis here, for the former the readers can get
further details from our paper.</p>
<p>Letâ€™s look at the overall picture of GTE in terms of HVGs and all the
genes.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_overall</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gte</span>, <span class="va">genes</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gte</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">gte</span><span class="op">[</span><span class="va">genes</span><span class="op">]</span>, decreasing <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>  <span class="va">quantile_nums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">gte</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>, <span class="va">gte</span><span class="op">)</span></span>
<span>  <span class="va">cum_gte</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">gte</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>GTE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">cum_gte</span><span class="op">[</span><span class="va">quantile_nums</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                  Percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'10'</span>, <span class="st">'20'</span>, <span class="st">'30'</span>, <span class="st">'40'</span>, <span class="st">'50'</span>, <span class="st">'60'</span>, <span class="st">'70'</span>, <span class="st">'80'</span>, <span class="st">'90'</span>, <span class="st">'100'</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggbarplot.html" class="external-link">ggbarplot</a></span><span class="op">(</span><span class="va">df</span>, x <span class="op">=</span> <span class="st">"Percentage"</span>, y <span class="op">=</span> <span class="st">"GTE"</span>,  </span>
<span>            legend <span class="op">=</span> <span class="st">"none"</span>, fill <span class="op">=</span> <span class="st">"gray"</span>, color <span class="op">=</span> <span class="st">"gray"</span>, </span>
<span>            font.label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, face <span class="op">=</span> <span class="st">"plain"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.7</span>, alpha <span class="op">=</span> <span class="fl">1</span>, </span>
<span>            label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">GTE</span>, <span class="fl">1</span><span class="op">)</span>, lab.size <span class="op">=</span> <span class="fl">3</span>, lab.col <span class="op">=</span> <span class="st">"black"</span>, lab.pos <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Top GTE genes (%)"</span>, y <span class="op">=</span> <span class="st">"Total GTE"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">q1</span> <span class="op">=</span> <span class="fu">plot_overall</span><span class="op">(</span><span class="va">GTE_ct</span><span class="op">$</span><span class="va">OverallTechEffects</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cumulative GTE of all genes"</span><span class="op">)</span></span>
<span><span class="va">q2</span> <span class="op">=</span> <span class="fu">plot_overall</span><span class="op">(</span><span class="va">GTE_ct</span><span class="op">$</span><span class="va">OverallTechEffects</span>, <span class="va">hvgs</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Cumulative GTE of HVGs"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">q1</span>, <span class="va">q2</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>We can see that whether in HVGs or in all genes, some genes dominate
the overall GTE, and we call these genes highly batch-sensitive genes
(HBGs). We can use the <code>Select.HBGs</code> or function to select
those HBGs.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GTE_ct_hvgs</span> <span class="op">=</span> <span class="va">GTE_ct</span></span>
<span><span class="va">GTE_ct_hvgs</span><span class="op">$</span><span class="va">GroupTechEffects</span> <span class="op">=</span> <span class="va">GTE_ct_hvgs</span><span class="op">$</span><span class="va">GroupTechEffects</span><span class="op">[</span><span class="va">hvgs</span>, <span class="op">]</span></span>
<span><span class="va">GTE_ct_hvgs</span><span class="op">$</span><span class="va">OverallTechEffects</span> <span class="op">=</span> <span class="va">GTE_ct_hvgs</span><span class="op">$</span><span class="va">OverallTechEffects</span><span class="op">[</span><span class="va">hvgs</span><span class="op">]</span></span>
<span><span class="va">HBGs_hvgs</span> <span class="op">=</span> <span class="fu"><a href="../reference/Select.HBGs.html">Select.HBGs</a></span><span class="op">(</span><span class="va">GTE_ct_hvgs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Find 1600 HBGs, GTE proportion: 0.978566476447474</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HBGs_hvgs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "mt-Cytb" "mt-Nd3"  "Camk2n1" "Kcnip4"  "Pcp4"    "Ftl1"</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HBGs_allgenes</span> <span class="op">=</span> <span class="fu"><a href="../reference/Select.HBGs.html">Select.HBGs</a></span><span class="op">(</span><span class="va">GTE_ct</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Find 7977 HBGs, GTE proportion: 0.97975022690868</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HBGs_allgenes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "mt-Atp6" "mt-Co3"  "mt-Co2"  "mt-Nd1"  "mt-Cytb" "mt-Co1"</span></span></code></pre>
<p>Letâ€™s see what happens when we remove these HBGs.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nonHBGs_hvgs</span> <span class="op">=</span> <span class="va">hvgs</span><span class="op">[</span><span class="op">!</span><span class="va">hvgs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">HBGs_hvgs</span><span class="op">]</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">nonHBGs_hvgs</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">nonhbgs_hvgs_umap</span><span class="op">)</span></span>
<span><span class="va">q1</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q2</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"SubClass"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">q1</span>, <span class="va">q2</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-8-1.png" width="1344"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nonHBGs_allgenes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">HBGs_allgenes</span><span class="op">]</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">nonHBGs_allgenes</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_allgenes_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_allgenes_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">nonhbgs_allgenes_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">nonhbgs_allgenes_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_allgenes_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">nonhbgs_allgenes_umap</span><span class="op">)</span></span>
<span><span class="va">q3</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_allgenes_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q4</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_allgenes_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"SubClass"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">q3</span>, <span class="va">q4</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-9-1.png" width="1344"></p>
<p>Removing HBGs from HVGs effectively removed the batch effects, while
PCA result on all genes still showed strong batch effects. This is
because the total GTE of the remaining genes is still large. Further
selection across all genes and removal of more HBGs do not improve the
results. In our paper, we show that removing too many genes from the all
genes in the scRNA-seq data results in insufficient variability in the
data to indicate cellular identity. Therefore, for scRNA-seq data, we
recommend that HBGs be calculated on HVGs and removed.</p>
</div>
<div class="section level4">
<h4 id="protocol-group-variable">1.3.2 Protocol group variable<a class="anchor" aria-label="anchor" href="#protocol-group-variable"></a>
</h4>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GTE_tech</span> <span class="op">=</span> <span class="fu"><a href="../reference/Run.GroupTechEffects.html">Run.GroupTechEffects</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">hvgs</span>, <span class="op">]</span>, <span class="va">meta</span>, g_factor <span class="op">=</span> <span class="st">"Protocol"</span>, b_factor <span class="op">=</span> <span class="st">"Batch"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">GTE_tech</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ GroupTechEffects  : num [1:4000, 1:3] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:4000] "Spsb1" "Ddi1" "Arl15" "Man1a" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:3] "10x 3' v2" "10x 3' v3" "Smart-seq v4"</span></span>
<span><span class="co">##  $ OverallTechEffects: Named num [1:4000] 7.08e-04 1.93e-06 1.57e-02 1.06e-03 4.58e-05 ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:4000] "Spsb1" "Ddi1" "Arl15" "Man1a" ...</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HBGs_hvgs</span> <span class="op">=</span> <span class="fu"><a href="../reference/Select.HBGs.html">Select.HBGs</a></span><span class="op">(</span><span class="va">GTE_tech</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Find 1200 HBGs, GTE proportion: 0.978190489960098</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HBGs_hvgs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "mt-Cytb" "Snhg11"  "Camk2n1" "Stmn1"   "Snca"    "Nrgn"</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nonHBGs_hvgs</span> <span class="op">=</span> <span class="va">hvgs</span><span class="op">[</span><span class="op">!</span><span class="va">hvgs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">HBGs_hvgs</span><span class="op">]</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">nonHBGs_hvgs</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">nonhbgs_hvgs_umap</span><span class="op">)</span></span>
<span><span class="va">q5</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q6</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"SubClass"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q7</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Protocol"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">q5</span>, <span class="va">q6</span>, <span class="va">q7</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-10-1.png" width="1920"></p>
</div>
<div class="section level4">
<h4 id="technology-group-variable">1.3.3 Technology group variable<a class="anchor" aria-label="anchor" href="#technology-group-variable"></a>
</h4>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GTE_tech</span> <span class="op">=</span> <span class="fu"><a href="../reference/Run.GroupTechEffects.html">Run.GroupTechEffects</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">hvgs</span>, <span class="op">]</span>, <span class="va">meta</span>, g_factor <span class="op">=</span> <span class="st">"Technology"</span>, b_factor <span class="op">=</span> <span class="st">"Batch"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">GTE_tech</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ GroupTechEffects  : num [1:4000, 1:2] 1.32e-05 2.11e-11 1.17e-02 1.43e-03 9.17e-07 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:4000] "Spsb1" "Ddi1" "Arl15" "Man1a" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:2] "scRNA" "snRNA"</span></span>
<span><span class="co">##  $ OverallTechEffects: Named num [1:4000] 7.82e-04 1.38e-06 4.04e-02 3.29e-03 3.77e-05 ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:4000] "Spsb1" "Ddi1" "Arl15" "Man1a" ...</span></span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HBGs_hvgs</span> <span class="op">=</span> <span class="fu"><a href="../reference/Select.HBGs.html">Select.HBGs</a></span><span class="op">(</span><span class="va">GTE_tech</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Find 1200 HBGs, GTE proportion: 0.981037995176774</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HBGs_hvgs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Kcnip4"  "Nrxn3"   "Snhg11"  "Ptprd"   "Fam155a" "Cntnap2"</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nonHBGs_hvgs</span> <span class="op">=</span> <span class="va">hvgs</span><span class="op">[</span><span class="op">!</span><span class="va">hvgs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">HBGs_hvgs</span><span class="op">]</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">nonHBGs_hvgs</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">nonhbgs_hvgs_umap</span><span class="op">)</span></span>
<span><span class="va">q5</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q6</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"SubClass"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q7</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Technology"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">q5</span>, <span class="va">q6</span>, <span class="va">q7</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-11-1.png" width="1920"></p>
</div>
<div class="section level4">
<h4 id="source-group-variable">1.3.4 Source group variable<a class="anchor" aria-label="anchor" href="#source-group-variable"></a>
</h4>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GTE_source</span> <span class="op">=</span> <span class="fu"><a href="../reference/Run.GroupTechEffects.html">Run.GroupTechEffects</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">hvgs</span>, <span class="op">]</span>, <span class="va">meta</span>, g_factor <span class="op">=</span> <span class="st">"Source"</span>, b_factor <span class="op">=</span> <span class="st">"Batch"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">GTE_source</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ GroupTechEffects  : num [1:4000, 1] 8.14e-04 3.82e-06 5.41e-02 4.02e-03 8.06e-05 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:4000] "Spsb1" "Ddi1" "Arl15" "Man1a" ...</span></span>
<span><span class="co">##   .. ..$ : chr "healthy MOp"</span></span>
<span><span class="co">##  $ OverallTechEffects: Named num [1:4000] 8.14e-04 3.82e-06 5.41e-02 4.02e-03 8.06e-05 ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:4000] "Spsb1" "Ddi1" "Arl15" "Man1a" ...</span></span></code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HBGs_hvgs</span> <span class="op">=</span> <span class="fu"><a href="../reference/Select.HBGs.html">Select.HBGs</a></span><span class="op">(</span><span class="va">GTE_source</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Find 1200 HBGs, GTE proportion: 0.976603344341924</span></span></code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HBGs_hvgs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "mt-Cytb" "Camk2n1" "Nrsn1"   "Pgm2l1"  "Pcp4"    "mt-Nd3"</span></span></code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nonHBGs_hvgs</span> <span class="op">=</span> <span class="va">hvgs</span><span class="op">[</span><span class="op">!</span><span class="va">hvgs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">HBGs_hvgs</span><span class="op">]</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">nonHBGs_hvgs</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">nonhbgs_hvgs_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">nonhbgs_hvgs_umap</span><span class="op">)</span></span>
<span><span class="va">q9</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q10</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"SubClass"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q11</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">nonhbgs_hvgs_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Source"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">q9</span>, <span class="va">q10</span>, <span class="va">q11</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-12-1.png" width="1920"></p>
</div>
</div>
<div class="section level3">
<h3 id="random-gene-removal">1.4 Random gene removal<a class="anchor" aria-label="anchor" href="#random-gene-removal"></a>
</h3>
<p>We show that random gene removal cannot remove the batch effects.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_genes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4000</span>, <span class="fl">2400</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">hvgs</span><span class="op">[</span><span class="op">-</span><span class="va">sample_genes</span><span class="op">]</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">subset_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">subset_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">subset_emb</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Spectral initialization failed to converge, using random initialization instead</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">subset_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">subset_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">subset_umap</span><span class="op">)</span></span>
<span><span class="va">r1</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">subset_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">r2</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">subset_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"SubClass"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">r1</span>, <span class="va">r2</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-13-1.png" width="1344"></p>
</div>
</div>
<div class="section level2">
<h2 id="application-of-gte-on-single-cell-proteomics-data">2. Application of GTE on single-cell proteomics data<a class="anchor" aria-label="anchor" href="#application-of-gte-on-single-cell-proteomics-data"></a>
</h2>
<div class="section level3">
<h3 id="load-data-matrix-and-metadata-1">2.1 Load data matrix and metadata<a class="anchor" aria-label="anchor" href="#load-data-matrix-and-metadata-1"></a>
</h3>
<p>We show that highly batch-sensitive features are applicable even for
single-cell data with few features.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"/home/server/zy/group_scripts/datasets_preparation/PBMCs_CITE/X.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  num [1:223, 1:8715] 0.238 0 0.238 0.43 0 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   ..$ : chr [1:223] "cd80" "cd86" "cd274" "cd273" ...</span></span>
<span><span class="co">##   ..$ : chr [1:8715] "AAACCCAAGACAAGCC-1_ctrl" "AAACCCAGTCGACTTA-1_ctrl" "AAACCCAGTCGGCACT-1_ctrl" "AAACCCAGTTGCAAGG-1_ctrl" ...</span></span></code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"/home/server/zy/group_scripts/datasets_preparation/PBMCs_CITE/meta.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">meta</span><span class="op">$</span><span class="va">Source</span> <span class="op">=</span> <span class="st">"homologous"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">meta</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    8715 obs. of  3 variables:</span></span>
<span><span class="co">##  $ Batch   : chr  "Ctrl" "Ctrl" "Ctrl" "Ctrl" ...</span></span>
<span><span class="co">##  $ CellType: chr  "NK" "CD4 T" "CD4 T" "CD4 T" ...</span></span>
<span><span class="co">##  $ Source  : chr  "homologous" "homologous" "homologous" "homologous" ...</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="visualization-of-raw-data-1">2.2 Visualization of raw data<a class="anchor" aria-label="anchor" href="#visualization-of-raw-data-1"></a>
</h3>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">raw_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">raw_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">raw_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">raw_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">raw_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">raw_umap</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">raw_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">raw_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"CellType"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-15-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="gte-calculation-and-highly-batch-sensitive-proteins-selection">2.3 GTE calculation and highly batch-sensitive proteins
selection<a class="anchor" aria-label="anchor" href="#gte-calculation-and-highly-batch-sensitive-proteins-selection"></a>
</h3>
<div class="section level4">
<h4 id="cell-type-group-variable-1">2.3.1 Cell type group variable<a class="anchor" aria-label="anchor" href="#cell-type-group-variable-1"></a>
</h4>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GTE_ct</span> <span class="op">=</span> <span class="fu"><a href="../reference/Run.GroupTechEffects.html">Run.GroupTechEffects</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">meta</span>, g_factor <span class="op">=</span> <span class="st">"CellType"</span>, b_factor <span class="op">=</span> <span class="st">"Batch"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">GTE_ct</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ GroupTechEffects  : num [1:223, 1:8] 1.14e-03 1.93e-02 8.66e-03 9.09e-08 6.29e-05 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:223] "cd80" "cd86" "cd274" "cd273" ...</span></span>
<span><span class="co">##   .. ..$ : chr [1:8] "B" "CD4 T" "CD8 T" "gdT" ...</span></span>
<span><span class="co">##  $ OverallTechEffects: Named num [1:223] 0.001613 0.021991 0.217141 0.001988 0.000293 ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:223] "cd80" "cd86" "cd274" "cd273" ...</span></span></code></pre>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HBPs</span> <span class="op">=</span> <span class="fu"><a href="../reference/Select.HBGs.html">Select.HBGs</a></span><span class="op">(</span><span class="va">GTE_ct</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Find 89 HBGs, GTE proportion: 0.977311277449056</span></span></code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HBPs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "cd69"  "cd3.2" "cd3.1" "cd25"  "cd71"  "cd28"</span></span></code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LTPs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">HBPs</span><span class="op">]</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">LTPs</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">ltps_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ltps_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">ltps_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ltps_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">ltps_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">ltps_umap</span><span class="op">)</span></span>
<span><span class="va">q1</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">ltps_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q2</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">ltps_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"CellType"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">q1</span>, <span class="va">q2</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-17-1.png" width="1152"></p>
</div>
<div class="section level4">
<h4 id="source-group-variable-1">2.3.2 Source group variable<a class="anchor" aria-label="anchor" href="#source-group-variable-1"></a>
</h4>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GTE_source</span> <span class="op">=</span> <span class="fu"><a href="../reference/Run.GroupTechEffects.html">Run.GroupTechEffects</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">meta</span>, g_factor <span class="op">=</span> <span class="st">"Source"</span>, b_factor <span class="op">=</span> <span class="st">"Batch"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Compute the group technical effects!</span></span></code></pre>
<pre><code><span><span class="co">## Done!</span></span></code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">GTE_source</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ GroupTechEffects  : num [1:223, 1] 1.57e-04 2.80e-05 1.22e-01 1.18e-07 5.85e-05 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:223] "cd80" "cd86" "cd274" "cd273" ...</span></span>
<span><span class="co">##   .. ..$ : chr "homologous"</span></span>
<span><span class="co">##  $ OverallTechEffects: Named num [1:223] 1.57e-04 2.80e-05 1.22e-01 1.18e-07 5.85e-05 ...</span></span>
<span><span class="co">##   ..- attr(*, "names")= chr [1:223] "cd80" "cd86" "cd274" "cd273" ...</span></span></code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HBPs</span> <span class="op">=</span> <span class="fu"><a href="../reference/Select.HBGs.html">Select.HBGs</a></span><span class="op">(</span><span class="va">GTE_source</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Find 45 HBGs, GTE proportion: 0.981333552938349</span></span></code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HBPs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "cd69"  "cd3.2" "cd3.1" "cd71"  "cd25"  "cd28"</span></span></code></pre>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LTPs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">HBPs</span><span class="op">]</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">LTPs</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">ltps_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ltps_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">ltps_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ltps_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">ltps_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">ltps_umap</span><span class="op">)</span></span>
<span><span class="va">q3</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">ltps_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q4</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">ltps_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"CellType"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">q3</span>, <span class="va">q4</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-19-1.png" width="1152"></p>
</div>
</div>
<div class="section level3">
<h3 id="random-protein-removal">2.4 Random protein removal<a class="anchor" aria-label="anchor" href="#random-protein-removal"></a>
</h3>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_proteins</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">223</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pca_res</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/irlba/man/irlba.html" class="external-link">irlba</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="op">-</span><span class="va">sample_proteins</span>, <span class="op">]</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">subset_emb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">u</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">subset_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></span><span class="op">(</span><span class="va">subset_emb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">subset_umap</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UMAP1"</span>, <span class="st">"UMAP2"</span><span class="op">)</span></span>
<span><span class="va">subset_umap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">subset_umap</span><span class="op">)</span></span>
<span><span class="va">r1</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">subset_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"Batch"</span>, palette <span class="op">=</span> <span class="st">"npg"</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">r2</span> <span class="op">=</span> <span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggscatter.html" class="external-link">ggscatter</a></span><span class="op">(</span><span class="va">subset_umap</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span>, size <span class="op">=</span> <span class="fl">0.1</span>, color <span class="op">=</span> <span class="st">"CellType"</span>, palette <span class="op">=</span> <span class="va">Colors</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">r1</span>, <span class="va">r2</span>, align <span class="op">=</span> <span class="st">'h'</span>, axis <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></code></pre></div>
<p><img src="GTE_usage_files/figure-html/unnamed-chunk-20-1.png" width="1152"></p>
<details><summary><strong>Session Info</strong>
</summary><div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.3 (2023-03-15)</span></span>
<span><span class="co">## Platform: x86_64-conda-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.10</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS/LAPACK: /home/server/anaconda3/envs/zy/lib/libopenblasp-r0.3.21.so</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] cowplot_1.1.1       randomcoloR_1.1.0.1 ggpubr_0.6.0       </span></span>
<span><span class="co">## [4] ggplot2_3.4.4       uwot_0.2.2          irlba_2.3.5.1      </span></span>
<span><span class="co">## [7] Matrix_1.5-4.1      GTEs_1.0.0         </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] Rcpp_1.0.12         lattice_0.21-8      tidyr_1.3.1        </span></span>
<span><span class="co">##  [4] digest_0.6.35       utf8_1.2.4          V8_4.4.2           </span></span>
<span><span class="co">##  [7] R6_2.5.1            backports_1.4.1     evaluate_0.23      </span></span>
<span><span class="co">## [10] highr_0.10          pillar_1.9.0        rlang_1.1.4        </span></span>
<span><span class="co">## [13] curl_5.2.1          rstudioapi_0.15.0   car_3.1-2          </span></span>
<span><span class="co">## [16] jquerylib_0.1.4     rmarkdown_2.26      pkgdown_2.0.7      </span></span>
<span><span class="co">## [19] labeling_0.4.3      textshaping_0.3.7   desc_1.4.3         </span></span>
<span><span class="co">## [22] Rtsne_0.17          stringr_1.5.1       RcppEigen_0.3.4.0.0</span></span>
<span><span class="co">## [25] munsell_0.5.1       broom_1.0.5         compiler_4.2.3     </span></span>
<span><span class="co">## [28] xfun_0.43           pkgconfig_2.0.3     systemfonts_1.0.6  </span></span>
<span><span class="co">## [31] htmltools_0.5.8.1   tidyselect_1.2.1    tibble_3.2.1       </span></span>
<span><span class="co">## [34] codetools_0.2-19    fansi_1.0.6         dplyr_1.1.4        </span></span>
<span><span class="co">## [37] withr_3.0.2         grid_4.2.3          jsonlite_1.8.8     </span></span>
<span><span class="co">## [40] gtable_0.3.5        lifecycle_1.0.4     magrittr_2.0.3     </span></span>
<span><span class="co">## [43] scales_1.3.0        cli_3.6.3           stringi_1.8.3      </span></span>
<span><span class="co">## [46] cachem_1.0.8        carData_3.0-5       farver_2.1.1       </span></span>
<span><span class="co">## [49] ggsignif_0.6.4      fs_1.6.4            bslib_0.7.0        </span></span>
<span><span class="co">## [52] ragg_1.2.7          generics_0.1.3      vctrs_0.6.5        </span></span>
<span><span class="co">## [55] ggsci_3.0.0         RcppAnnoy_0.0.22    tools_4.2.3        </span></span>
<span><span class="co">## [58] glue_1.8.0          purrr_1.0.2         abind_1.4-5        </span></span>
<span><span class="co">## [61] fastmap_1.1.1       yaml_2.3.8          colorspace_2.1-0   </span></span>
<span><span class="co">## [64] cluster_2.1.4       rstatix_0.7.2       memoise_2.0.1      </span></span>
<span><span class="co">## [67] knitr_1.46          sass_0.4.9</span></span></code></pre>
</details>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Yang Zhou.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
